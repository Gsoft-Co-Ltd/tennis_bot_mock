<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>申し送り・会員メモ統合</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
body {
  background-color: #fff;
  font-family: Arial, sans-serif;
  padding:20px;
}

/* --- 申し送り用のデザイン --- */
.delivery-note-card {
  margin-bottom: 15px;
  border-left: 4px solid #007bff;
  padding: 15px;
  position: relative;
}
.delivery-note-card h5 {
  margin-bottom: 5px;
  font-size: 1rem; /* 文字サイズを1remに統一 */
}
.delivery-note-card p {
  margin-bottom: 0;
  font-size: 1rem; /* pタグも同様に1remに */
}
.status-badge {
  display: inline-block;
  background: #ffc107;
  color: #000;
  font-size: 0.8rem;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 10px;
}
.delivery-button-group {
  position: absolute;
  top: 15px;
  right: 15px;
  display: flex;
  gap:5px;
}
.delivery-button-group .btn {
  font-size: 0.8rem;
  padding:2px 8px;
}

/* --- 会員メモのデザイン --- */
.member-note-card {
  margin-bottom: 15px;
  border-left: 4px solid #007bff;
  padding-left: 15px;
}
.member-note-card h5 {
  margin-bottom: 5px;
  font-size: 1rem; /* 文字サイズを1remに統一 */
}
.member-note-card p {
  margin-bottom: 0;
  font-size: 1rem; /* pタグも同様に1remに */
}
</style>
</head>
<body>

<!-- 申し送りセクション -->
<section class="mt-3">
  <h5 class="mb-3">申し送り事項</h5>
  <div id="delivery-notes-container">
    <!-- サンプルメモ（報告前状態） -->
    <div class="delivery-note-card">
      <div>
        <h5>2023/11/01 追加</h5>
        <p>会費の引落に失敗しています。</p>
      </div>
      <div class="delivery-button-group">
        <button class="btn btn-warning btn-sm" onclick="markReported(this)">報告済み</button>
        <button class="btn btn-danger btn-sm" onclick="deleteNote(this)">削除</button>
      </div>
    </div>
  </div>
  <button class="btn btn-primary mt-3" onclick="addNote()">新しい申し送り事項を追加</button>
</section>

<hr class="my-5"/>

<!-- 会員メモセクション -->
<section class="mt-3">
  <h5 class="mb-3">会員メモ</h5>
  <div id="member-cards-container">
    <div class="member-note-card d-flex justify-content-between align-items-center">
      <div>
        <h5>2023-10-10 （記入コーチ: 佐藤健）</h5>
        <p>フォアハンドフォームが安定。次回バックハンド強化。</p>
      </div>
      <button class="btn btn-danger btn-sm" onclick="deleteCard(this)">削除</button>
    </div>
    <div class="member-note-card d-flex justify-content-between align-items-center">
      <div>
        <h5>2023-09-15 （記入コーチ: 鈴木美穂）</h5>
        <p>サーブスピード向上。体幹トレ続行。</p>
      </div>
      <button class="btn btn-danger btn-sm" onclick="deleteCard(this)">削除</button>
    </div>
  </div>
  <button class="btn btn-primary mt-3" onclick="addCard()">新しいメモを追加</button>
</section>

<!-- スクリプト -->
<script>
// ======================= 申し送り関連 =======================
function addNote() {
  const container = document.getElementById("delivery-notes-container");
  const note = document.createElement("div");
  note.classList.add("delivery-note-card");
  // ※ 日付表記を削除して「新規申し送り」に変更
  note.innerHTML = `
    <div>
      <textarea class="form-control mb-2" placeholder="新しい申し送り事項を入力"></textarea>
    </div>
    <div class="delivery-button-group">
      <button class="btn btn-success btn-sm" onclick="saveNewNote(this)">保存</button>
    </div>
  `;
  container.prepend(note);
}

function saveNewNote(btn) {
  const noteCard = btn.closest('.delivery-note-card');
  const textarea = noteCard.querySelector('textarea');
  const text = textarea.value.trim();
  if(!text) {
    alert("メモを入力してください。");
    return;
  }
  textarea.remove();

  // ボタンを「報告済み/削除ボタン」に切り替え
  const buttonGroup = noteCard.querySelector('.delivery-button-group');
  buttonGroup.innerHTML = `
    <button class="btn btn-warning btn-sm" onclick="markReported(this)">報告済み</button>
    <button class="btn btn-danger btn-sm" onclick="deleteNote(this)">削除</button>
  `;

  // 入力したテキストを表示
  const p = document.createElement('p');
  p.textContent = text;
  noteCard.querySelector('div').appendChild(p);
}

function markReported(btn) {
  const noteCard = btn.closest('.delivery-note-card');
  const h5 = noteCard.querySelector('h5');
  if(!h5.querySelector('.status-badge')) {
    const badge = document.createElement('span');
    badge.classList.add('status-badge');
    badge.textContent = '報告済み';
    h5.appendChild(badge);
  }
}

function deleteNote(btn) {
  if(confirm("このメモを削除しますか？\n報告済みのメモも含め完全に削除されます。")) {
    btn.closest('.delivery-note-card').remove();
  }
}

// ======================= 会員メモ関連 =======================
function addCard() {
  const container = document.getElementById("member-cards-container");
  const card = document.createElement("div");
  card.classList.add("member-note-card","d-flex","justify-content-between","align-items-center");

  // ※ 日付表記を削除し、担当コーチはドロップダウンで選択
  card.innerHTML = `
    <div>
      <label for="coachSelect" class="form-label mb-1">担当コーチ</label>
      <select class="form-select form-select-sm mb-2" id="coachSelect">
        <option value="">コーチを選択</option>
        <option value="佐藤健">佐藤健</option>
        <option value="鈴木美穂">鈴木美穂</option>
        <option value="田中花子">田中花子</option>
      </select>
      <textarea class="form-control mb-2" placeholder="メモを入力"></textarea>
    </div>
    <button class="btn btn-success btn-sm" onclick="saveCard(this)">保存</button>
  `;
  container.prepend(card);
}

function saveCard(btn) {
  const card = btn.closest('.member-note-card');
  const textarea = card.querySelector('textarea');
  const coachSelect = card.querySelector('select');
  const text = textarea.value.trim();
  const coachName = coachSelect.value;

  if(!text) {
    alert("カルテを入力してください。");
    return;
  }
  if(!coachName) {
    alert("担当コーチを選択してください。");
    return;
  }

  // テキストエリアと保存ボタンを除去し、選択したコーチと内容を表示
  textarea.remove();
  btn.remove();
  coachSelect.remove();

  const h5 = card.querySelector('h5');
  h5.textContent = `（担当コーチ: ${coachName}）`; // コーチ名を見出しに反映

  const p = document.createElement('p');
  p.textContent = text;
  card.querySelector('div').appendChild(p);
}

function deleteCard(btn) {
  if(confirm("このカルテを削除しますか？")) {
    btn.closest('.member-note-card').remove();
  }
}
</script>

</body>
</html>
