<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>時間軸とレッスンを同じ10分刻みグリッドで</title>
<style>
:root {
  --border-color: #e2e8f0;
  --text-color: #334155;
  --bg-white: #fff;
  --bg-court: #f0f8ff;
  --primary-blue: #3498db;
}

/* リセット */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: "Noto Sans JP", sans-serif;
  background: #f8fafc;
  color: var(--text-color);
}

/* カード */
.card {
  background: var(--bg-white);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-top: 20px;
  padding: 10px 20px;
  display: inline-block;
}
.select-group, .switch-group {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}
.select-group label { font-weight: 600; }
.select-group select, .switch-group select {
  padding: 6px 12px;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  font-size: 14px;
  background: #fff;
}
.select-group button, .switch-group button {
  background-color: var(--primary-blue);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
}

#day-schedule-container {
  width: 1000px;
  margin: 20px auto;
  padding: 10px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background: var(--bg-white);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.day-schedule-title {
  font-size: 16px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 10px;
}

/* ▼ 10分刻みのCSS Grid (9:00～21:30 → 75コマ) 
   行1: 時刻ラベル
   行2～: コートごとのレッスン
   col1: コート名/空、 col2..col(2+75)=col77(排他) */
#grid-schedule {
  display: grid;
  grid-template-columns:
    100px
    repeat(75, 1fr); 
  grid-auto-rows: auto;
  column-gap: 2px;
  row-gap: 8px;
  overflow-x: auto; 
  padding-bottom: 10px;
  border-top: 1px solid var(--border-color);
  position: relative;
}

/* 時刻ラベル (行1) */
.time-label {
  font-size: 12px;
  color: #64748b;
  text-align: center;
  padding: 4px;
  border-right: 1px solid #ccc;
  /* 余裕あれば他の装飾 */
}

/* コート名セル */
.court-label {
  background: var(--bg-court);
  text-align: center;
  font-weight: bold;
  padding: 6px 0;
}

/* レッスンボタン */
.day-lesson {
  border: 1px solid var(--border-color);
  border-radius: 4px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  padding: 6px;
  font-size: 12px;
  font-weight: bold;
  text-align: center;
  line-height: 1.4;
  white-space: pre-wrap;
  min-height: 60px;
  cursor: pointer;
}
.day-lesson:hover {
  opacity: 0.9;
}
/* レベル別色 */
.day-lesson.beginner {
  background-color: #d1eaff;
}
.day-lesson.intermediate {
  background-color: #d1ffd9;
}
.day-lesson.advanced {
  background-color: #f1d1ff;
}

/* ポップアップ例 */
.overlay {
  display: none;
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  z-index: 999;
}
.popup {
  display: none;
  position: fixed; 
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  background: #fff;
  width: 90%; max-width: 500px;
  height: 400px;
  border-radius: 8px;
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.popup iframe {
  width: 100%; 
  height: 100%;
  border: none;
}
</style>
</head>
<body>

<!-- 企業・スクール選択(モック) -->
<div class="card">
  <div class="select-group">
    <label for="companySelect">企業:</label>
    <select id="companySelect">
      <option value="companyA" selected>株式会社A</option>
      <option value="companyB">株式会社B</option>
    </select>

    <label for="schoolSelect">スクール:</label>
    <select id="schoolSelect">
      <option value="schoolX" selected>東京スクール</option>
      <option value="schoolY">大阪スクール</option>
    </select>

    <button id="selectButton">選択</button>
  </div>
</div>

<!-- スケジュール切り替え -->
<div class="card">
  <div class="switch-group">
    <button id="today-button">今日の予定</button>
    <select id="filter-day">
      <option value="月曜日">月曜日</option>
      <option value="火曜日">火曜日</option>
      <option value="水曜日">水曜日</option>
      <option value="木曜日">木曜日</option>
      <option value="金曜日">金曜日</option>
      <option value="土曜日">土曜日</option>
      <option value="日曜日">日曜日</option>
    </select>
  </div>
</div>

<!-- メイン -->
<div id="day-schedule-container">
  <div class="day-schedule-title" id="day-schedule-title"></div>
  <div id="grid-schedule"></div>
</div>

<!-- ポップアップ(モック) -->
<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
  <iframe id="popup-iframe" src=""></iframe>
</div>

<script>
/* 0) ダミーデータ (レッスン2枠+コート3面) */
const dayTimeslots = {
  "月曜日": [
    // (例) 9:00～9:30(初級), 9:30～10:00(上級)
    { start:"09:00", end:"09:30", level:"beginner", coaches:["中村","山本"] },
    { start:"09:30", end:"10:00", level:"advanced", coaches:["田中"] },
  ],
  /* 他曜日など省略 */
};
const courts=["コートA","コートB","コートC"];
const days=["月曜日","火曜日","水曜日","木曜日","金曜日","土曜日","日曜日"];

/** レッスンまとめ */
const lessons=[];
days.forEach(day=>{
  const arr= dayTimeslots[day]||[];
  arr.forEach(slot=>{
    courts.forEach(c=>{
      lessons.push({
        day,
        court: c,
        level: slot.level,
        coaches: slot.coaches||[],
        startTime: slot.start,
        endTime: slot.end
      });
    });
  });
});

/* 1) ポップアップ(ダミー) */
function showPopup(les){
  const ov= document.getElementById("overlay");
  const pp= document.getElementById("popup");
  const ifr=document.getElementById("popup-iframe");
  if(!ov||!pp||!ifr)return;
  // コーチ配列を渡す例
  const q = new URLSearchParams({
    day:les.day,
    court:les.court,
    level:les.level,
    coaches:les.coaches.join(","),
    start:les.startTime,
    end:les.endTime
  }).toString();
  ifr.src= "lesson_popup.html?"+q;
  ov.style.display='block';
  pp.style.display='block';
}
function closePopup(){
  document.getElementById("overlay").style.display='none';
  document.getElementById("popup").style.display='none';
  document.getElementById("popup-iframe").src='';
}
document.getElementById("overlay").addEventListener("click",closePopup);

/* 2) 10分刻み(9:00～21:30=75コマ) */
function timeToTenOffset(tstr){
  const [H,M]= tstr.split(":").map(Number);
  const offset= (H-9)*6 + Math.floor(M/10);
  if(offset<0)return 0;
  if(offset>75)return 75; //21:30
  return offset;
}
/** grid-column: (開始) / (終了) → 終了は+0 */
function getGridColumnRange(start,end){
  const s= timeToTenOffset(start);
  const e= timeToTenOffset(end);
  return {
    startCol: 2 + s,
    endCol:   2 + e   // +1しない
  };
}

/** コートは行3～ (A=0->3, B=1->4, etc.) */
function getCourtRow(idx){
  return 3+ idx;
}
function levelToText(lv){
  return ({ beginner:"初級", intermediate:"中級", advanced:"上級" })[lv]||lv;
}

/* 3) スケジュール描画 */
function generateDaySchedule(day){
  const title= document.getElementById("day-schedule-title");
  const grid=  document.getElementById("grid-schedule");
  if(!title||!grid)return;

  // タイトル
  const wd=["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"];
  const now=new Date();
  const diff= wd.indexOf(day)- now.getDay();
  const tgt= new Date(now);
  tgt.setDate(now.getDate()+ diff);
  const label= `${tgt.getMonth()+1}月${tgt.getDate()}日(${day})`;
  title.textContent= label+" のスケジュール";

  // クリア
  grid.innerHTML="";

  // 行1: 時刻ラベル( offset=0..75 )
  // col1(左上)は空
  const emptyDiv= document.createElement("div");
  emptyDiv.style.gridRow="1"; 
  emptyDiv.style.gridColumn="1";
  grid.appendChild(emptyDiv);

  for(let off=0; off<=75; off++){
    const col= 2+ off;
    // 9:00+ off*10分
    const totalMin= off*10;
    const HH= 9 + Math.floor(totalMin/60);
    const MM= totalMin%60;
    // 30分刻みラベルにするなら if(off%3==0){...} でもOK
    const lbl= document.createElement("div");
    lbl.className="time-label";
    lbl.textContent= `${String(HH).padStart(2,"0")}:${String(MM).padStart(2,"0")}`;
    lbl.style.gridRow= "1";
    lbl.style.gridColumn= `${col} / ${col+1}`;
    grid.appendChild(lbl);
  }

  // 行2は(省略など) → 行3以降にコート
  courts.forEach((cName,cIdx)=>{
    const row= getCourtRow(cIdx);
    // 左端にコート名
    const cLabel= document.createElement("div");
    cLabel.className="court-label";
    cLabel.textContent= cName;
    cLabel.style.gridRow= row;
    cLabel.style.gridColumn="1";
    grid.appendChild(cLabel);

    // レッスン配置
    const dayLessons= lessons.filter(l=>l.day===day && l.court===cName);
    dayLessons.forEach(les=>{
      const {startCol,endCol}= getGridColumnRange(les.startTime, les.endTime);
      const lessonDiv= document.createElement("div");
      lessonDiv.className="day-lesson "+ les.level;
      const coachText= les.coaches.join("\n");
      lessonDiv.textContent=
        `${levelToText(les.level)}\n`+
        `${coachText}\n`+
        `${les.startTime} - ${les.endTime}`;

      lessonDiv.style.gridRow= row;
      lessonDiv.style.gridColumn= `${startCol} / ${endCol}`;
      lessonDiv.onclick= ()=> showPopup(les);
      grid.appendChild(lessonDiv);
    });
  });
}

/* ダミーボタン */
document.getElementById("selectButton").addEventListener("click",()=>{
  alert("企業・スクール選択(モック)");
});
document.getElementById("today-button").addEventListener("click",()=>{
  const t = getTodayName();
  const sel= document.getElementById("filter-day");
  if([...sel.options].some(o=>o.value===t)){
    sel.value= t;
  }
  generateDaySchedule(t);
});
function getTodayName(){
  const w=["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"];
  return w[new Date().getDay()];
}
document.getElementById("filter-day").addEventListener("change",function(){
  generateDaySchedule(this.value);
});

/* 初期表示 */
document.addEventListener("DOMContentLoaded",()=>{
  const sel= document.getElementById("filter-day");
  const t= getTodayName();
  if([...sel.options].some(o=>o.value===t)){
    sel.value= t;
  }
  generateDaySchedule(sel.value);
});
</script>
</body>
</html>
