<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>年会費設定</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background-color: #f5f7fa;
      font-family: Arial, sans-serif;
      padding-bottom:50px;
    }
    .section-description {
      font-size:0.9rem;
      color:#666;
    }
    .table-fixed-header {
      max-height: 300px;
      overflow-y:auto;
    }
    .table-fixed-header table {
      width:100%;
      border-collapse: collapse;
    }
    .table-fixed-header th, .table-fixed-header td {
      border:1px solid #ddd;
      padding:8px;
      white-space: nowrap;
    }
    .table-fixed-header th {
      background-color:#f2f2f2;
      position:sticky;
      top:0;
      z-index:10;
    }
    .small-note {
      font-size:0.8rem;
      color:#555;
    }
  </style>
</head>
<body>
<div class="container mt-4">
  <h1 class="mb-4">年会費設定</h1>

  <div class="card mb-4">
    <div class="card-body">
      <h5>年会費ルール設定</h5>
      <p class="section-description">
        年に1回、自動で請求される年会費を設定します。  
        例：毎年4月1日に5,000円を自動請求、など。
      </p>

      <div class="row g-2 align-items-end mb-3">
        <div class="col-md-4">
          <label class="form-label">名称</label>
          <input type="text" class="form-control" id="annualFeeName" placeholder="例: 年会費(一般)" />
        </div>
        <div class="col-md-3">
          <label class="form-label">金額（税抜）</label>
          <input type="number" class="form-control" id="annualFeeAmount" placeholder="例:5000" />
        </div>
        <div class="col-md-3">
          <label class="form-label">請求日</label>
          <input type="date" class="form-control" id="annualFeeDate" />
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-secondary w-100" onclick="addAnnualFee()">追加</button>
        </div>
      </div>
      <div class="small-note mb-3">
        「請求日」は毎年同日に請求します。日付のみで、年は指定不要（毎年繰り返し）  
        必要に応じて「対象コース・レベル」を別画面で管理、もしくはこのルール追加時に選択できるよう拡張可能。
      </div>

      <div class="table-fixed-header mb-3" id="annualFeeTableContainer">
        <table>
          <thead>
          <tr>
            <th>名称</th>
            <th>金額</th>
            <th>請求日</th>
            <th>削除</th>
          </tr>
          </thead>
          <tbody id="annualFeesBody">
          <!-- 年会費ルール行が追加 -->
          </tbody>
        </table>
      </div>

      <button type="button" class="btn btn-primary" onclick="saveSettings()">設定を保存</button>
    </div>
  </div>

  <h5 class="mt-4">現在の設定</h5>
  <div id="currentSettings" class="alert alert-info">設定されていません</div>
</div>

<script>
  const annualFees = [];

  function addAnnualFee() {
    const name = document.getElementById('annualFeeName').value;
    const amount = document.getElementById('annualFeeAmount').value;
    const date = document.getElementById('annualFeeDate').value;

    if(!name || !amount || !date) {
      alert("名称・金額・請求日は必須です");
      return;
    }

    annualFees.push({name, amount, date});
    renderAnnualFees();

    document.getElementById('annualFeeName').value = '';
    document.getElementById('annualFeeAmount').value = '';
    document.getElementById('annualFeeDate').value = '';
  }

  function renderAnnualFees() {
    const body = document.getElementById('annualFeesBody');
    body.innerHTML = '';
    annualFees.forEach((fee,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${fee.name}</td>
        <td>¥${fee.amount||0}</td>
        <td>${fee.date}</td>
        <td><button class="btn btn-danger btn-sm" onclick="removeAnnualFee(${i})">削除</button></td>
      `;
      body.appendChild(tr);
    });
  }

  function removeAnnualFee(index) {
    annualFees.splice(index,1);
    renderAnnualFees();
  }

  function saveSettings() {
    const settings = {annualFees};
    console.log(settings);
    let text = "";
    if(annualFees.length>0) {
      annualFees.forEach((f,i)=>{
        text += `${i+1}. ${f.name}: ¥${f.amount}, 請求日:${f.date}\n`;
      });
    }else{
      text = "年会費設定なし";
    }
    document.getElementById('currentSettings').textContent = text;
    alert("設定が保存されました！");
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
